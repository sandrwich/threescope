<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threescope</title>
  <link rel="icon" type="image/png" href="/textures/sat_icon.png">
  <meta name="theme-color" content="#101010">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/textures/icon-192.png">
  <style>
    @font-face {
      font-family: 'Overpass Mono';
      src: url('/textures/overpass-mono.ttf') format('truetype');
      font-weight: 400;
      font-display: swap;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%; overflow: hidden;
      background: #101010;
      font-family: 'Overpass Mono', 'Courier New', monospace;
      color: #fff;
    }
    canvas { display: block; }

    #ui-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; user-select: none;
    }
    #ui-overlay > * { pointer-events: auto; }

    /* Loading screen */
    #loading-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: #101010; z-index: 1000;
    }
    #loading-screen .bar-outer {
      width: 400px; height: 30px; border: 2px solid #fff;
    }
    #loading-screen .bar-inner {
      height: 100%; width: 0%; background: #d3d3d3; transition: width 0.3s;
      margin: 4px; height: calc(100% - 8px);
    }
    #loading-screen .msg {
      margin-bottom: 16px; font-size: 20px; color: #fff;
    }

    /* Top-left controls text */
    #controls-panel {
      position: absolute; top: 10px; left: 10px;
      font-size: 20px; line-height: 24px; color: #d3d3d3;
      letter-spacing: 0.5px;
    }
    #controls-panel .time-line { color: #fff; }

    /* Bottom-left: attribution */
    #bottom-panel {
      position: absolute; bottom: 10px; left: 10px;
      font-size: 14px; line-height: 1.5; color: #666;
    }

    /* Checkboxes â€” matching raygui box style */
    #checkbox-panel {
      position: absolute; top: 114px; left: 10px;
      display: flex; flex-direction: column; gap: 4px;
    }
    #checkbox-panel label {
      display: flex; align-items: center; gap: 8px;
      font-size: 16px; cursor: pointer; color: #fff;
      line-height: 24px;
    }
    /* Hide native checkbox */
    #checkbox-panel input[type="checkbox"] {
      appearance: none; -webkit-appearance: none;
      width: 20px; height: 20px;
      border: 2px solid #aaa; background: transparent;
      cursor: pointer; position: relative; flex-shrink: 0;
    }
    #checkbox-panel input[type="checkbox"]:hover {
      border-color: #fff;
    }
    /* Checked: solid inner square (raygui style) */
    #checkbox-panel input[type="checkbox"]:checked::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px; right: 2px; bottom: 2px;
      background: #fff;
    }

    /* TLE Picker */
    #tle-picker {
      position: absolute; bottom: 10px; right: 10px;
      display: flex; flex-direction: column; align-items: flex-end; gap: 6px;
    }
    #tle-picker select, #tle-picker button, #tle-picker input[type="text"] {
      background: #1a1a1a; color: #fff; border: 1px solid #666;
      padding: 4px 8px; font-size: 16px; font-family: inherit;
      cursor: pointer;
    }
    #tle-picker select:hover, #tle-picker button:hover, #tle-picker input[type="text"]:hover {
      border-color: #aaa;
    }
    #tle-custom-row {
      display: none; gap: 4px; align-items: center;
    }
    #tle-custom-row.visible { display: flex; }
    #tle-url-input {
      width: 260px; cursor: text;
    }
    #tle-url-input::placeholder { color: #555; }
    #tle-file-input {
      position: absolute; width: 0; height: 0; overflow: hidden;
      opacity: 0; pointer-events: none;
    }

    /* Stats (top-right) */
    #stats-panel {
      position: absolute; top: 10px; right: 10px;
      text-align: right;
    }
    #stats-panel .fps { color: #00ff00; font-size: 20px; font-weight: bold; }
    #stats-panel .sat-count { color: #d3d3d3; font-size: 16px; margin-top: 2px; }

    /* Satellite info tooltip */
    #sat-info {
      position: absolute; display: none;
      background: rgba(0,0,0,0.8); padding: 10px 14px;
      font-size: 18px; line-height: 1.4;
      min-width: 260px; pointer-events: none;
    }
    #sat-info .sat-name { font-size: 20px; margin-bottom: 6px; }
    #sat-info .sat-detail { color: #fff; }

    /* Apsis labels */
    .apsis-label {
      position: absolute; display: none; font-size: 16px;
      pointer-events: none; white-space: nowrap;
    }
    .apsis-label.peri { color: #87ceeb; }
    .apsis-label.apo { color: #ffa500; }

    #bottom-panel a {
      color: #888; text-decoration: none; pointer-events: auto;
    }
    #bottom-panel a:hover { color: #ccc; }

    /* Info button (mobile only) */
    #info-btn {
      display: none;
      position: absolute; bottom: 10px; left: 10px;
      width: 32px; height: 32px;
      background: rgba(255,255,255,0.1); border: 1px solid #666;
      color: #ccc; font-size: 18px; font-family: inherit;
      cursor: pointer; line-height: 30px; text-align: center;
    }
    #info-btn:hover { border-color: #aaa; color: #fff; }

    /* Info modal */
    #info-modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 999; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.7);
    }
    #info-modal.visible { display: flex; }
    #info-modal-content {
      background: #1a1a1a; border: 1px solid #666;
      padding: 20px 24px; max-width: 340px; width: 90%;
      font-size: 14px; line-height: 1.6; color: #ccc;
    }
    #info-modal-content h3 {
      font-size: 16px; color: #fff; margin-bottom: 10px; font-weight: normal;
    }
    #info-modal-content .section { margin-bottom: 14px; }
    #info-modal-content .section:last-child { margin-bottom: 0; }
    #info-modal-content a { color: #888; text-decoration: none; }
    #info-modal-content a:hover { color: #ccc; }
    #info-modal-close {
      background: transparent; border: 1px solid #666;
      color: #ccc; font-size: 14px; font-family: inherit;
      padding: 6px 16px; cursor: pointer; margin-top: 12px;
    }
    #info-modal-close:hover { border-color: #aaa; color: #fff; }

    /* Prevent overscroll/pull-to-refresh on mobile */
    html, body { overscroll-behavior: none; touch-action: none; }

    /* Mobile responsive */
    @media (max-width: 600px) {
      #info-btn { display: block; }
      #controls-panel { display: none; }
      #checkbox-panel { top: 10px; left: 10px; }
      #checkbox-panel label { font-size: 13px; line-height: 20px; }
      #checkbox-panel input[type="checkbox"] { width: 24px; height: 24px; min-height: 24px; }
      #stats-panel .fps { font-size: 16px; }
      #stats-panel .sat-count { font-size: 13px; }
      #sat-info { font-size: 13px; min-width: 180px; padding: 8px 10px; }
      #sat-info .sat-name { font-size: 15px; }
      #tle-picker select, #tle-picker button, #tle-picker input[type="text"] {
        font-size: 14px; padding: 6px 8px;
      }
      #tle-url-input { width: 140px; }
      #tle-custom-row { flex-wrap: wrap; justify-content: flex-end; }
      #bottom-panel { display: none; }
      #loading-screen .bar-outer { width: 80%; max-width: 300px; height: 24px; }
      #loading-screen .msg { font-size: 16px; }
    }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="msg" id="loading-msg">Initializing...</div>
    <div class="bar-outer"><div class="bar-inner" id="loading-bar"></div></div>
  </div>

  <div id="info-modal">
    <div id="info-modal-content">
      <div class="section">
        <h3>Controls</h3>
        Drag to orbit / pan<br>
        Pinch to zoom<br>
        Tap satellite to select<br>
        Double-tap to lock view
      </div>
      <div class="section">
        <h3>About</h3>
        TLE data from <a href="https://celestrak.org" target="_blank">CelesTrak</a><br>
        Based on <a href="https://github.com/aweeri/TLEscope" target="_blank">TLEscope</a> by aweeri<br>
        <a href="https://github.com/aweeri/TLEscope/blob/main/LICENSE" target="_blank">AGPL-3.0</a>
        &middot; <a href="https://github.com/sandrwich/threescope" target="_blank">Source code</a>
      </div>
      <button id="info-modal-close">Close</button>
    </div>
  </div>

  <div id="ui-overlay">
    <button id="info-btn">?</button>
    <div id="controls-panel"></div>
    <div id="checkbox-panel">
      <label><input type="checkbox" id="cb-hide-unselected"> Hide Unselected</label>
      <label><input type="checkbox" id="cb-clouds"> Show Clouds</label>
      <label><input type="checkbox" id="cb-night-lights" checked> Night Lights</label>
    </div>
    <div id="tle-picker">
      <select id="tle-select"></select>
      <div id="tle-custom-row">
        <input type="text" id="tle-url-input" placeholder="TLE URL...">
        <button id="tle-url-btn">Load</button>
        <button id="tle-file-btn">File</button>
        <input type="file" id="tle-file-input" accept=".tle,.txt,.3le">
      </div>
    </div>
    <div id="stats-panel">
      <div class="fps" id="fps-display">-- FPS</div>
      <div class="sat-count" id="sat-count-display">0 Sats</div>
    </div>
    <div id="sat-info">
      <div class="sat-name" id="sat-info-name"></div>
      <div class="sat-detail" id="sat-info-detail"></div>
    </div>
    <div class="apsis-label peri" id="peri-label"></div>
    <div class="apsis-label apo" id="apo-label"></div>
    <div id="bottom-panel">
      <div>
        TLE data from <a href="https://celestrak.org" target="_blank">CelesTrak</a><br>
        Based on <a href="https://github.com/aweeri/TLEscope" target="_blank">TLEscope</a> by aweeri
        &middot; <a href="https://github.com/aweeri/TLEscope/blob/main/LICENSE" target="_blank">AGPL-3.0</a>
        &middot; <a href="https://github.com/sandrwich/threescope" target="_blank">Source code</a>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
